## Validation of EM assumptions

Here, we validate the assumption that using a point electrode instead of a finite electrode has limited impact on the results. We know that the potential recorded by a spherical electrode in an infinite homogeneous medium is identical to that recorded by a point electrode, for sources outside of the sphere.

We compare the weights produced for infinitesimal electrodes to weights calculated under the assumption that the minimum distance between a neural segment and an electrode is 6 um (given that a Neuropixels contact is 12x12 um). 

To generate the weights files, install [the latest version of BlueRecording](https://github.com/joseph-tharayil/BlueRecording/tree/master) according to the instructions in the ReadMe. Then download the circuit model, and calculate the positions of the neural segments in the model, as described in the BlueRecording ReadMe. Alternatively, the positions are available in [this Zenodo repository](https://zenodo.org/records/14998743). Then, run the script `run_initialize_sphereSizes.py` to initialize the weights files. Then, run the script `run_write_weights_sphereSizes.py` to populate the weights files. We recommend that you run the latter scripy using MPI, with `mpirun -n <your number of cores> python run_write_weights_sphereSizes.py`

Note that these scripts assume that you have already generated a one-timestep simulation of the underlying circuit, and also calculated the segment positions for this circuit, as described in the BlueRecording repo. **You will have to modify the paths to the simulation config file, and to the segment position folders, in these scripts. You will also have to modify the paths to the circuit data in the provided simulation config files**

In the file Validation.ipynb, we use these weights files to identify segments which are within 6 $\mu$m of an electrode contact. We then select the segment with the smallest distance to an electrode from among the cells which fire in the first two seconds of the simulation. We run a simulation in which we calculate the LFP at the location of the relevant electrode from the entire circuit, with both infinitesimal and 6 $\mu$m electrodes. The weights file for this simulation is generated by running the scripts `run_initialize_2sphereSizes.py` and `run_write_weights_2sphereSizes.py`, as described above. The simulation is defined using the config file `simulation_config_recording.json` **(note that to run this simulation, you will need to modify the paths to the circuit data in this config file)**. Finally, we use the notebook `lookAtLFPs.py` to compare the signals recorded in this scenario from the two electrodes, and confirm that even when a cell with a segment less that 6 $\mu$m from an electrode spikes, the error caused by the assumption that electrodes are infinitesimally small is negligible. 
